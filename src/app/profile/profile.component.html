<section style="background-color: #eee;">
  <p-toast position="top-left"/>
    <div class="container py-5">
  
      <div class="row">
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-body text-center">
              <img [src]="user?.image_url" alt="avatar"
                class="rounded-circle img-fluid" style="width: 150px;">
              <h5 class="my-3">{{user?.name}}</h5>
              <div class="d-flex justify-content-center mb-2">
                <p-fileUpload 
                    mode="basic" 
                    chooseLabel="Change photo" 
                    chooseIcon="pi pi-upload"
                    name="image" 
                    #fileUploader
                    accept="image/*" 
                    maxFileSize="1000000" 
                    [customUpload]="true"
                    (uploadHandler)="changePhoto($event)" />
              </div>
            </div>
          </div>
          
        </div>
        <div class="col-lg-8">
          <div class="card mb-4">
            <div class="card-body">
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Full Name</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">{{user?.name}}</p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Email</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">{{user?.email}}</p>
                </div>
              </div>
              <hr>
             
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="card mb-4 mb-md-0">
                <div class="card-body">
                    <h6>Change Your Name</h6>
                    <form [formGroup]="updateNameForm" class="my-4" (ngSubmit)="updateName()">
                      
                        <p-floatLabel>
                            <input pInputText id="username" formControlName="name" [value]="user?.name"/>
                            <label for="username">Username</label>
                        </p-floatLabel>

                        @if(updateNameForm.get('name')?.errors!==null&&updateNameForm.get('name')?.touched){
                          <div class="p-0 mt-3">
                            @if(updateNameForm.get('name')?.errors?.['minlength'])
                            {<p class="text-danger">Name is short</p>}
                            @if(updateNameForm.get('name')?.errors?.['maxlength'])
                            {<p class="text-danger">Max name length is 50.</p>}
                          </div>
                          }

                        <button  type="submit" [disabled]="updateNameForm.invalid" data-mdb-button-init data-mdb-ripple-init class="btn btn-outline-success ms-1 my-2">Update</button>
                    </form>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card mb-4 mb-md-0">
                <div class="card-body">
                    <h6>Change Password</h6>
                    <form class="my-4" [formGroup]="changePasswordForm" (ngSubmit)="changePassword()">

                      <div class="my-4">
                        <p-floatLabel>
                          <p-password
                          name="currentPassword"
                            [toggleMask]="true"
                              [feedback]="false"
                              [promptLabel]="'At least one character'"
                              formControlName="currentPassword"/>
                          <label for="password">Current Password</label>
                        </p-floatLabel>
                      </div>
                      <div class="my-4">
                        <p-floatLabel>
                          <p-password
                            [toggleMask]="true"
                              [feedback]="false"
                              [promptLabel]="'At least one character'"
                              formControlName="password"/>
                          <label for="password">New Password</label>
                        </p-floatLabel>
                      </div>
                      <div class="my-4">
                        <p-floatLabel>
                          <p-password
                            [toggleMask]="true"
                              [feedback]="false"
                              [promptLabel]="'At least one character'"
                              formControlName="confirmPassword"/>
                          <label for="password">Confirm Password</label>
                        </p-floatLabel>
                      </div>
                        
                      @if(changePasswordForm.get("password")?.errors != null && changePasswordForm.get("password")?.touched){
                        <div class="text-danger">
                            @if(changePasswordForm.get('password')?.errors?.['minlength'])
                            {<p class="text-danger">Password is short</p>}
                            @if(changePasswordForm.get('password')?.errors?.['maxlength'])
                            {<p class="text-danger">Max password length is 20.</p>}
                        </div>
                        
                    }

                    @if(passwordError){
                      <div class="text-danger">
                        <p class="text-danger">{{passwordError}}</p>
                    </div>
                    }

                        <button  type="submit" [disabled]="changePasswordForm.invalid" data-mdb-button-init data-mdb-ripple-init class="btn btn-outline-success ms-1 my-2">Update</button>
                    </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>